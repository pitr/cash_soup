<html>
<head>
<title>nice</title>
<link rel="stylesheet" href="style.css" TYPE="text/css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="http://graupel.oanda.com:8080/hackto/fxtrade.js"></script>
<script type="text/javascript" src="fux.js"></script>
<script language="javascript" src="processing.init.js"></script>
<script language="javascript" src="processing.js"></script>
</head>
<body>


<div id="wrapper">
	<div id="prompt" style="display:none">

	</div>
	<div id="splash">
		<h1>CASH SS$OUP! (WTF?)<br/><br/><br/> PLEASE STAND BY</h1>
	</div>

	<div id="main" style="display:none">

    <script type="application/processing">
    // Global variables
    int NUM = symbols.length;
    Spore SPORES = new Spore[NUM];
    int DELAY = 70;

    float SCALE;
    float SCALE_MIN = 99999.0;
    float SCALE_MAX = 0.0;
    float RADIUS_MIN = 20.0;
    float RADIUS_MAX = 200.0;

    class Spore {
      float R, nR; // current/new radius
      float B, nB; // current/new border margin
      int X, Y; // current location
      int nX, nY; // new location
      Object symbol;

      int[] myColour;
      int[] myRadiusColor;

      int scale;
      float ask; //tmp radius

      Spore(Object key) {
        symbol = key;
        scale = symbol.scale;
		myColor = symbol.color; //color(symbol.color[0], symbol.color[1], symbol.color[2], symbol.color[3]); 
		//console.log(myColor);
		myRadiusColor = {253, 253, 253, 99}; // array
        R = 0.0;
        nR = R;
        B = 2.0;
        nB = B;
        X = width / 2 + int(random(-200,200));
        Y = height / 2 + int(random(-100,100));
        nX = 10*int(random(-2,2)); // X
        nY = 10*int(random(-2,2)); // Y
      }

	  // Test to see if mouse is over this spring  
	  boolean over() {  
	    float disX = X - mouseX+200; // WTF ? why offset by 200? Something in the dom is causing this offset requirement - KV  
	    float disY = Y - mouseY;  
		
	    if (sqrt(sq(disX) + sq(disY)) < (R+B)/2 ) {  
	      return true;  
	    } else {  
	      return false;  
	    }  
	  }  

      void draw() {
        setRadius(RADIUS_MIN + (ask-SCALE_MIN)/(SCALE_MAX-SCALE_MIN)*(RADIUS_MAX-RADIUS_MIN));

        R += (nR-R)/DELAY;
        B += (nB-B)/DELAY;

        // Track circle to new destination
        //X += (nX-X)/DELAY;
        //Y += (nY-Y)/DELAY;
        X += nX/DELAY;
        Y += nY/DELAY;

        // Draw circle
		//console.log(symbol.key + ': ' + myColor[0]);

		color c = color(myRadiusColor[0],myRadiusColor[1],myRadiusColor[2], myRadiusColor[3]);
		color d = color(myColor[0], myColor[1], myColor[2], over() ? 255 : myColor[3] );
		
        fill(c); // outer (white)
        ellipse( X%width, Y%height, R+B, R+B );
		//console.log(myColor);
		color d = color(myColor[0], myColor[1], myColor[2], myColor[3]);
        fill(d); // inner (blue)
        ellipse( X%width, Y%height, R, R );
		if (over()) {
			fill(255,255,255,160);
			rect(X+50, Y-20, 45, 20);
			fill(0,0,0,200);
	  		PFont font = loadFont("FFScala-32.vlw");
			textFont(font);
			text(symbol.key, X+18, Y-10);
		}

      }

      void update() {
        if(symbol.data) {
          ask = symbol.data.ask;
          ask = scale > 0 ? ask : 1.0 / ask;
          SCALE_MIN = min(SCALE_MIN, ask);
          SCALE_MAX = max(SCALE_MAX, ask);
        }
      }

      // move towards (x,y)
      void move(int x, int y) {
        nX = x;
        nY = y;
      }

      void setRadius(float r) {
        nR = max(r, 0.0);
      }

      void setBorder(float b) {
        nB = max(b, 0.0);
      }
    }

    // Setup the Processing Canvas
    void setup(){
	  rectMode(CENTER_RADIUS);
      size( 1000, 500 );
      noStroke();
      frameRate( 30 );
      for(int i=0; i<NUM; i++) {
        SPORES[i] = new Spore(symbols[i]);
        SPORES[i].setRadius( 0.0 );
      }
    }

    // Main draw loop
    void draw(){
      // Fill canvas grey
      background( 100 );

      for(int i=0; i<NUM; i++) {
        SPORES[i].update();
      }
      for(int i=0; i<NUM; i++) {
        SPORES[i].draw();
      }
    }

    </script>

    <canvas width='1000' height='500'></canvas>

		<table id="datatable">
			<thead>
				<tr>
					<th>KEY</th>
					<th>ASK</th>
				</tr>
			</thead>
			<tbody>
				<script>
					$.each(symbols,
						function(i, symbol) {
							document.write('<tr data-symbol="'+symbol.key+'"><td style="background: rgba('+symbol.color[0]+','+symbol.color[1]+','+symbol.color[2]+',0.5)">'+symbol.key+'</td><td class="ask">--</td></tr>');
						}
					);
				</script>
			</tbody>
		</table>
	</div>
</div>



</body>
</html>